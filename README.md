How to itegrate logback form spring apps in ECS with cloud watchLogback Appender: 

  1. Direct integration in your Spring app; flexible but requires dependency configuration.
     Update the logback.xml or logback-spring.xml
    <configuration>
      <appender name="CLOUDWATCH" class="com.github.lorello.aws.CloudWatchAppender">
        <logGroupName>your-log-group</logGroupName>
        <logStreamName>your-log-stream</logStreamName>
        <awsAccessKeyId>your-access-key-id</awsAccessKeyId>
        <awsSecretAccessKey>your-secret-access-key</awsSecretAccessKey>
        <region>us-east-1</region>
      </appender>

      <root level="INFO">
        <appender-ref ref="CLOUDWATCH"/>
      </root>
    </configuration>

  2.  Docker Logging Driver: Easier, managed by ECS, requires minimal setup but less flexible.
     a. In your ECS Task Definition, configure the container's logging driver to use awslogs
        {
          "logConfiguration": {
            "logDriver": "awslogs",
            "options": {
              "awslogs-group": "/ecs/your-log-group",
              "awslogs-region": "us-east-1",
              "awslogs-stream-prefix": "ecs"
            }
          }
        }
        b.Ensure that your ECS Task Role has the necessary IAM permissions to write logs to CloudWatch:
          {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "logs:CreateLogGroup",
                  "logs:CreateLogStream",
                  "logs:PutLogEvents"
                ],
                "Resource": "*"
              }
            ]
          }


     
  3. CloudWatch Agent: Offers flexibility and advanced configuration for custom log files.

     If more flexibility is needed (e.g., sending custom log files or log formats), you can use the CloudWatch Agent to stream logs from your ECS container to CloudWatch.

      Steps:
       Install the CloudWatch Agent in your Docker container or configure it in your ECS Task Definition.
       Configure the CloudWatch Agent to monitor specific log files generated by your Spring Boot application.
       The CloudWatch Agent's configuration file (amazon-cloudwatch-agent.json) would look like:
        {
          "logs": {
            "logs_collected": {
              "files": {
                "collect_list": [
                  {
                    "file_path": "/var/log/spring-app.log",
                    "log_group_name": "/ecs/your-log-group",
                    "log_stream_name": "spring-app-log",
                    "timestamp_format": "%b %d %H:%M:%S"
                  }
                ]
              }
            }
          }
        }
       Ensure the necessary IAM permissions are attached to the ECS task role for CloudWatch logs.

  4. Spring Cloud AWS: Seamless AWS integration for Spring apps, but may require additional setup.

     -----------------------------------------------------------
Splunk Integration
Options:
1. Docker Logging Driver (Simple): Quick and minimal setup. Logs directly from the ECS container to Splunk.
2. Splunk HTTP Event Collector (More Control): More flexible; allows custom formatting, batching, and control from the application level.
3. Sidecar for Log Forwarding (Separation of Concerns): Keeps your application container lightweight and delegates log forwarding to a dedicated container.

     1. Using Docker Splunk Logging Driver
The simplest way is to configure ECS to use the Docker logging driver for Splunk. Docker can directly send logs from the ECS container to a Splunk instance.

Steps:
Modify ECS Task Definition: You can configure the Splunk logging driver in your ECS task definition like this:

{
  "family": "your-task-family",
  "containerDefinitions": [
    {
      "name": "spring-app",
      "image": "your-docker-image",
      "essential": true,
      "logConfiguration": {
        "logDriver": "splunk",
        "options": {
          "splunk-token": "YOUR-SPLUNK-HEC-TOKEN",
          "splunk-url": "https://YOUR-SPLUNK-HEC-ENDPOINT:8088",
          "splunk-index": "your-index",
          "splunk-sourcetype": "_json",
          "splunk-insecureskipverify": "true"
        }
      },
      "memory": 512,
      "cpu": 256,
      ...
    }
  ]
}
Key Parameters:

splunk-token: Your Splunk HEC token used for authentication.
splunk-url: The HEC endpoint where the logs should be sent.
splunk-index: The index where the logs will be stored in Splunk.
splunk-sourcetype: The Splunk sourcetype (e.g., _json).
splunk-insecureskipverify: Set to true if you are using self-signed certificates (optional).
Ensure ECS Task Role Permissions:
Ensure the ECS Task Role has the required permissions for Docker's Splunk logging driver.

IAM permissions aren't directly needed for Splunk, but ensure your ECS role has the correct task execution permissions for ECS and Docker.
